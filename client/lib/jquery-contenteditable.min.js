"use strict";/*!
 * jQuery UI Contenteditable 1.0.0
 * Lightweight jQuery UI plugin providing more convenient API to use "contenteditable" feature.
 * 
 * Copyright: Alexey Grinko, 2016
 * Git repository: https://github.com/agrinko/jquery-contenteditable.git
 * 
 * @license MIT - https://opensource.org/licenses/MIT
 */
!function(t){t.widget("ui.editable",{version:"1.0.0",widgetEventPrefix:"edit",options:{content:"self",saveDelay:!1,multiline:!1,exitKeys:["escape"],className:"ui-editable",editingClass:"ui-editable-editing",invalidClass:"ui-editable-invalid",autoselect:!1,preventUndo:!1,cancel:"a",start:null,end:null,input:null,save:null,validate:null},keyCode:{down:40,end:35,enter:13,escape:27,left:37,right:39,space:32,tab:9,up:38},_create:function(){this.ready=!1,this.mode="normal",this.element.addClass(this.options.className),this.content="self"!=this.options.content&&this.options.content?this.element.find(this.options.content):this.element,this._bindEvents()},_bindEvents:function(){this._on({mousedown:this._prepare,mouseup:this._capture,dragstart:this._cancel}),this._bindContentEvents()},_bindContentEvents:function(){this.content.on("keydown"+this.eventNamespace,this._keydown.bind(this)).on("input"+this.eventNamespace,this._input.bind(this)).on("blur"+this.eventNamespace,this.finish.bind(this))},_prepare:function(e){t(e.target).closest(this.options.cancel).length||1===e.which&&(this.ready=!0)},_cancel:function(){this.ready=!1},_capture:function(){this.ready&&(this.start(),this.ready=!1)},getText:function(){return this.content[0].innerText||this.content[0].textContent},start:function(){if("edit"!==this.mode){if(this._trigger("start")===!1)return!1;this._mode("edit"),this.content.focus(),this.isValid=!0,this.validContent=this.getText(),this.options.autoselect&&this.select()}},finish:function(t){"normal"!==this.mode&&(this._save(),this.isValid||this.content.text(this.validContent),this._mode("normal"),t&&"blur"==t.type||this.content.blur(),this._trigger("end"))},validate:function(){var t=this._trigger("validate",null,{content:this.getText()});return t===!1?this.element.addClass(this.options.invalidClass):this.element.removeClass(this.options.invalidClass),this.isValid=t!==!1},select:function(){var t=document.createRange(),e=window.getSelection();t.selectNodeContents(this.content[0]),e.removeAllRanges(),e.addRange(t)},_mode:function(t){switch(t){case"edit":this.element.addClass(this.options.editingClass),this.element.data("ui-draggable")&&this.element.draggable("disable"),this.content.prop("contenteditable",!0);break;case"normal":this.element.removeClass([this.options.editingClass,this.options.invalidClass].join(" ")),this.element.data("ui-draggable")&&this.element.draggable("enable"),this.content.prop("contenteditable",!1)}this.mode=t},_input:function(t){if("edit"==this.mode){var e={content:this.getText()};return this._trigger("input",t,e)!==!1&&void(0===this.options.saveDelay?this._save():this.options.saveDelay>0&&this._debouncedSave(this.options.saveDelay))}},_save:function(){var t=this.getText();t!=this.validContent&&this.validate()&&(this.validContent=t,this._trigger("save",null,{content:this.validContent}))},_debouncedSave:function(t){var e=this;this.__save_timeout&&clearTimeout(this.__save_timeout),this.__save_timeout=setTimeout(function(){e._save(),e.__save_timeout=null},t)},_keydown:function(t){var e=this;if("normal"!==this.mode){if(this.options.preventUndo&&t.ctrlKey&&(t.keyCode==="Z".charCodeAt(0)||t.keyCode==="Y".charCodeAt(0)||t.keyCode==="Z".charCodeAt(0)&&t.shiftKey))return!1;if(this.options.exitKeys){var i=this.options.exitKeys.some(function(i){return t.keyCode===e.keyCode[i.toLowerCase()]});if(i)return void this.finish()}return!(!this.options.multiline&&t.keyCode===this.keyCode.enter)&&void 0}},_destroy:function(){this.element.removeClass([this.options.className,this.options.editingClass,this.options.invalidClass].join(" ")),this.content.off(this.eventNamespace)}})}(jQuery);